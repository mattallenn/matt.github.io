<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Polaris Project | Matthew Allen Portfolio</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: #0a0a0f;
            color: #e0e0e0;
            line-height: 1.8;
            overflow-x: hidden;
            position: relative;
        }

        /* Starfield background */
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 100%);
        }

        /* Animated gradient overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(20, 20, 40, 0.3) 0%, rgba(10, 10, 15, 0.8) 100%);
            pointer-events: none;
            z-index: -1;
        }

        a {
            color: #64ffda;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        a:hover {
            color: #00d9ff;
            text-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
        }

        header {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1.5rem;
            background: rgba(10, 10, 15, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(100, 255, 218, 0.2);
            z-index: 100;
            transition: all 0.3s ease;
        }

        header.scrolled {
            padding: 1rem;
            background: rgba(10, 10, 15, 0.95);
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        nav a {
            font-size: 0.65rem;
            padding: 0.5rem 1rem;
            position: relative;
            transition: all 0.3s ease;
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #64ffda;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        nav a:hover::after {
            width: 100%;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            /* Padding to clear the fixed header */
            padding-top: 100px;
        }

        /* Keep section styles for compatibility, though we use .project-content */
        section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 4rem 0;
            opacity: 0;
            transform: translateY(50px);
            transition: all 1s ease;
        }

        section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            text-align: center;
            color: #64ffda;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.5);
            letter-spacing: 0.1em;
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: #64ffda;
            text-shadow: 0 0 15px rgba(100, 255, 218, 0.3);
            border-bottom: 2px solid rgba(100, 255, 218, 0.3);
            padding-bottom: 1rem;
            letter-spacing: 0.05em;
        }

        p,
        li {
            font-size: 0.65rem;
            color: #b0bec5;
            line-height: 1.8;
        }

        .subtitle {
            text-align: center;
            color: #00d9ff;
            font-size: 0.7rem;
            margin-top: 1rem;
            margin-bottom: 3rem; /* Added margin */
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        footer {
            text-align: center;
            padding: 2rem;
            border-top: 2px solid rgba(100, 255, 218, 0.2);
            color: #64ffda;
            font-size: 0.6rem;
            margin-top: 4rem;
        }

        .github-corner {
            position: fixed;
            top: 0;
            right: 0;
            z-index: 101;
        }

        /* --- NEW STYLES FOR PROJECT PAGE --- */

        /* This centers your content and gives it a max-width */
        .project-content {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Style for the disclaimer */
        .project-content .disclaimer {
            font-size: 0.6rem;
            font-style: italic;
            color: #b0bec5;
            text-align: center;
            max-width: 700px;
            margin: 2rem auto 3rem auto;
            border: 1px dashed rgba(100, 255, 218, 0.3);
            padding: 1rem;
            border-radius: 8px;
            background: rgba(20, 20, 30, 0.4);
            line-height: 1.6;
        }

        /* Styles for your project images */
        .project-content img {
            width: 100%;
            border-radius: 8px;
            margin: 1.5rem auto 1.5rem auto;
            display: block;
            border: 2px solid rgba(100, 255, 218, 0.2);
            background: rgba(20, 20, 30, 0.4);
        }
        
        /* Spacing for paragraphs */
        .project-content p {
            margin-bottom: 2rem;
        }

        /* Spacing for headings */
        .project-content h2 {
            margin-top: 3rem;
        }

        /* Styles for your code blocks */
        pre[class*="language-"] {
            background: rgba(0, 0, 0, 0.7) !important;
            font-size: 0.6rem !important;
            line-height: 1.6;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            border: 1px solid rgba(100, 255, 218, 0.2);
            margin: 1.5rem 0 1.5rem 0;
            font-family: 'Courier New', Courier, monospace; /* Use a mono font for code */
        }

        code[class*="language-"] {
            background: transparent !important;
            font-family: 'Courier New', Courier, monospace; /* Use a mono font for code */
            text-shadow: none;
        }
        
        /* Style for the "Back" link */
        .back-nav {
            text-align: center;
            margin-top: 4rem;
            padding: 1rem;
            display: block;
            background: rgba(20, 20, 30, 0.6);
            border: 2px solid rgba(100, 255, 218, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .back-nav a {
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        .back-nav:hover {
            border-color: #64ffda;
            background: rgba(30, 30, 40, 0.8);
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(100, 255, 218, 0.2);
        }

        /* --- END OF NEW STYLES --- */


        @media (max-width: 768px) {
            h1 {
                font-size: 1.2rem;
            }

            h2 {
                font-size: 1rem;
            }

            nav {
                gap: 1rem;
            }

            nav a {
                font-size: 0.5rem;
                padding: 0.5rem;
            }
            
            /* Remove project grid styles, not needed here */
        }
    </style>
</head>

<body>

    <canvas id="starfield"></canvas>

    <a href="https://github.com/mattallenn" class="github-corner" aria-label="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250"
            style="fill:#64ffda; color:#0a0a0f; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" />
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm" />
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body" />
        </svg>
    </a>

    <header id="header">
        <nav>
            <a href="index.html#home">HOME</a>
            <a href="index.html#projects">PROJECTS</a>
            <a href="index.html#hobbies">HOBBIES</a>
            <a href="index.html#about">ABOUT</a>
            <a href="index.html#contact">CONTACT</a>
        </nav>
    </header>

    <main>
        <h1>POLARIS</h1>
        <p class="subtitle">[ COLD-GAS THRUSTER SYSTEM ]</p>
        
        <div class="project-content">

            <p class="disclaimer">Disclaimer: This project is part of Purdue Orbital's GNC team. This is by no means a
                solo project, but rather a collaborative effort among many talented individuals. My specific
                contributions are detailed below.
            </p>

            <h2>&gt; OVERVIEW_</h2>
            <img src="images/polaris-cad.jpg" alt="Polaris CAD Model" loading="lazy" />
            <p>
                Polaris is a cold-gas thruster system designed to actively stabilize the launchpad just before launch,
                ensuring the platform remains secure and steady during critical moments. The system is built around an
                RP2040-based microcontroller that controls relays and solenoids, powered by batteries, and continuously
                monitors environmental conditions through a network of sensors.

                As the lead software engineer, I am responsible for developing and maintaining the control software that
                drives this system. My role involves integrating hardware, software, and electronics, as well as
                developing the control software.
            </p>

            <h2>&gt; DETAILS_</h2>
            <img src="images/hardware.png" alt="Polaris hardware" loading="lazy" />
            <p>
                The microcontroller interfaces with sensors such as the IMU and magnetometer, as well as with relays
                that control the air solenoids for the thrusters. The initial prototype is complete! We’re now
                engineering a flight-weight system that will be used on the mission. Current efforts include
                implementing the CAN bus protocol for communication with other subsystems, selecting a smaller
                microcontroller (with a push toward a custom PCB), and designing the wiring harness and power system.
                There are many design decisions in progress, and reliability is the top priority.
            </p>

            <img src="images/graph.png" alt="PID Tuning Graph" loading="lazy" />
            <p>
                Above is a ground test that was ran. The control program was executed, followed by a manual spin test
                of Polaris to observe its response. Highlighted portions represent manual spins. The sign convention
                used is as follows: positive indicates clockwise rotation, and negative indicates counter-clockwise
                rotation. Observed oscillations are due to the test unit swaying during the experiment.
            </p>

            <pre><code class="language-python">
# PID Loop
while True:
            
    try:
        # Loop through different headings
        cycle_headings()

        current_time = time.monotonic()s # Store monotonic time
        current_heading = get_current_heading()
        
        ## For data logging
      _x, gyro_y, gyro_z = sensor.gyro or (999,999,999)
        
        # Compute with wraparound handling
        # This means 0 and 360 are treated the same.
        error = (setpoint - current_heading + 180) % 360 - 180
            
        # Compute delta T
        delta_time = current_time - last_time
        last_time = current_time

        # Compute Derivative
        ## check if logic
        derivative = (error - previous_error) / delta_time if delta_time > 0 else 0
        previous_error = error

        # Compute PID output
        output = (Kp * error) + (Kd * derivative)
              </code></pre>
            <p>
                The above code snippet showcases the core PID control loop used in Polaris. It continuously reads the
                current heading from the IMU, calculates the error relative to the desired setpoint, and computes the
                PID output to adjust thruster activation accordingly. This specific implementation is from a "Martian"
                test, which cycles between headings of 0°, 90°, 180°, and 270° to evaluate system response and tune PID
                parameters, as well as look cool!
            </p>

            <img src="images/schematic1.png" alt="Flight Prototype" loading="lazy" />
            <img src="images/schematic2.png" alt="Flight Prototype"loading="lazy" />
            <img src="images/schematic3.png" alt="Flight Prototype" loading="lazy" />
            <p>
                The wiring schematics for the different components are shown above. Key components include the RP2040
                microcontroller, IMU, magnetometer, solenoid valves, relays, and power supply.
            </p>

            <nav class="back-nav">
                <a href="index.html">← BACK TO PORTFOLIO</a>
            </nav>

        </div> </main>

    <footer>
        [ THANKS FOR VISITING ] - MATT
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <script>
        // Starfield canvas animation
        const canvas = document.getElementById('starfield');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const stars = [];
        const numStars = 200;
        const shootingStars = []; // Array to hold shooting stars
        let lastShootingStarTime = 0;
        const shootingStarMinInterval = 5000; // Minimum 5 seconds between shooting stars
        const shootingStarMaxInterval = 15000; // Maximum 15 seconds between shooting stars
        let nextShootingStarInterval = Math.random() * (shootingStarMaxInterval - shootingStarMinInterval) + shootingStarMinInterval;


        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.z = Math.random() * 2;
                this.size = Math.random() * 1.5;
                this.speed = Math.random() * 0.2 + 0.1;
                this.twinkleSpeed = Math.random() * 0.02 + 0.01;
                this.twinkleDirection = Math.random() > 0.5 ? 1 : -1;
                this.opacity = this.z;
                this.isTwinkling = Math.random() > 0.7;
            }

            update() {
                this.y += this.speed;

                // Wrap around instead of resetting
                if (this.y > canvas.height) {
                    this.y = -10;
                }
                if (this.y < -10) {
                    this.y = canvas.height;
                }

                // Twinkle effect
                if (this.isTwinkling) {
                    this.opacity += this.twinkleSpeed * this.twinkleDirection;
                    if (this.opacity >= this.z || this.opacity <= 0.2) {
                        this.twinkleDirection *= -1;
                    }

                    // Randomly stop twinkling
                    if (Math.random() > 0.995) {
                        this.isTwinkling = false;
                        this.opacity = this.z;
                    }
                } else {
                    // Randomly start twinkling
                    if (Math.random() > 0.998) {
                        this.isTwinkling = true;
                    }
                }
            }

            draw() {
                ctx.fillStyle = `rgba(100, 255, 218, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // NEW: Shooting Star class
        class ShootingStar {
            constructor() {
                this.reset();
            }

            reset() {
                // Start from top-left to bottom-right (or similar diagonal)
                this.x = -Math.random() * canvas.width * 0.5; // Start off-screen left
                this.y = Math.random() * canvas.height * 0.3; // Start from top third of screen
                this.length = Math.random() * 100 + 50; // Length of the tail
                this.speedX = Math.random() * 5 + 3; // Horizontal speed
                this.speedY = Math.random() * 2 + 1; // Vertical speed
                this.opacity = 1;
                this.brightness = Math.random() * 0.5 + 1.0; // Brighter than regular stars
                this.color = `rgba(255, 255, 255, ${this.opacity})`;
                this.fadeSpeed = 0.02; // How quickly it fades out after reaching max travel
                this.active = true;
            }

            update() {
                if (!this.active) return;

                this.x += this.speedX;
                this.y += this.speedY;

                // Fade out once it's mostly across the screen
                if (this.x > canvas.width * 0.6) { // Start fading when it's passed more than half the screen
                    this.opacity -= this.fadeSpeed;
                    this.color = `rgba(255, 255, 255, ${Math.max(0, this.opacity)})`;
                }

                if (this.opacity <= 0) {
                    this.active = false;
                }
            }

            draw() {
                if (!this.active) return;

                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x - this.length * (this.speedX / (this.speedX + this.speedY)), this.y - this.length * (this.speedY / (this.speedX + this.speedY)));
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 1.5;
                ctx.lineCap = 'round';
                ctx.stroke();
            }
        }


        for (let i = 0; i < numStars; i++) {
            stars.push(new Star());
        }

        function animate(currentTime) {
            // Use the 0.3 opacity to prevent trail clutter
            ctx.fillStyle = 'rgba(10, 10, 15, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            stars.forEach(star => {
                star.update();
                star.draw();
            });

            // NEW: Shooting star generation and update
            if (currentTime - lastShootingStarTime > nextShootingStarInterval) {
                shootingStars.push(new ShootingStar());
                lastShootingStarTime = currentTime;
                nextShootingStarInterval = Math.random() * (shootingStarMaxInterval - shootingStarMinInterval) + shootingStarMinInterval;
            }

            for (let i = shootingStars.length - 1; i >= 0; i--) {
                const sStar = shootingStars[i];
                sStar.update();
                sStar.draw();

                if (!sStar.active) {
                    shootingStars.splice(i, 1); // Remove inactive shooting stars
                }
            }

            requestAnimationFrame(animate);
        }

        animate(0); // Call animate with initial time

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Scroll animations
        const sections = document.querySelectorAll('section');
        const header = document.getElementById('header');

        const observerOptions = {
            threshold: 0.15,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        sections.forEach(section => {
            observer.observe(section);
        });

        // Header scroll effect
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    </script>

</body>

</html>